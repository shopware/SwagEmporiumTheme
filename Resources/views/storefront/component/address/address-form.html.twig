{% sw_extends '@Storefront/storefront/component/address/address-form.html.twig' %}

{% block component_address_form_company_name_input %}
    <input type="text"
           class="form-control{% if violationPath %} is-invalid{% endif %}"
           id="{{ idPrefix ~ prefix }}company"
           placeholder="{{ "address.companyNamePlaceholder"|trans|striptags }}{% if prefix != "shippingAddress" and accountTypeRequired %}{{ "general.required"|trans|sw_sanitize }}{% endif %}"
           name="{{ prefix }}[company]"
           value="{{ data.get('company') }}"
           {% if prefix != "shippingAddress" and accountTypeRequired %}required="required"{% endif %}>
{% endblock %}

{% block component_address_form_phone_number_input %}
    <input type="text"
           class="form-control"
           id="{{ idPrefix ~ prefix }}AddressPhoneNumber"
           placeholder="{{ "address.phoneNumberPlaceholder"|trans|striptags }}{{ config('core.loginRegistration.phoneNumberFieldRequired') ? "general.required"|trans|sw_sanitize }}"
           name="{{ prefix }}[phoneNumber]"
           value="{{ data.get('phoneNumber') }}"
        {{ config('core.loginRegistration.phoneNumberFieldRequired') ? 'required="true"' }}>
{% endblock %}

{% block component_address_form_country_select %}
    <select class="country-select {{ formSelectClass }}{% if violationPath %} is-invalid{% endif %}"
            id="{{ idPrefix ~ prefix }}AddressCountry"
            name="{{ prefix }}[countryId]"
            required="required"
            data-initial-country-id="{{ initialCountryId }}">
        {% if not initialCountryId %}
            <option disabled="disabled"
                    value=""
                    selected="selected">
                {{ "address.countryPlaceholder"|trans|sw_sanitize }}{{ "general.required"|trans|sw_sanitize }}
            </option>
        {% endif %}
        {% for country in page.countries %}
            <option {% if country.id == initialCountryId %}
                selected="selected"
            {% endif %}
                value="{{ country.id }}"
                data-vat-id-required="{{ country.vatIdRequired }}"
                data-state-required="{{ country.forceStateInRegistration }}"
                {% if feature('FEATURE_NEXT_15707') and  not country.shippingAvailable and disableNonShippableCountries %}
                disabled="disabled"
                {% endif %}>
                {{ country.translated.name }}{% if feature('FEATURE_NEXT_15707') and showNoShippingPostfix and not country.shippingAvailable %} {{ "address.countryPostfixNoShipping"|trans|sw_sanitize }}{% endif %}
            </option>
        {% endfor %}
    </select>
{% endblock %}

{% block component_address_form_city_input %}
    <input type="text"
           class="form-control{% if violationPath %} is-invalid{% endif %}"
           id="{{ idPrefix ~ prefix }}AddressCity"
           placeholder="{{ "address.cityPlaceholder"|trans|striptags }}{{ "general.required"|trans|sw_sanitize }}"
           name="{{ prefix }}[city]"
           value="{{ data.get('city') }}"
           data-form-validation-required
           {% if requiredMessage is defined %}data-form-validation-required-message="{{ requiredMessage }}"{% endif %}
           required="required">
{% endblock %}

{% block component_address_form_zipcode_input %}
    <input type="text"
           class="form-control{% if violationPath %} is-invalid{% endif %}"
           id="{{ idPrefix ~ prefix }}AddressZipcode"
           placeholder="{{ "address.zipcodePlaceholder"|trans|striptags }}{{ "general.required"|trans|sw_sanitize }}"
           name="{{ prefix }}[zipcode]"
           value="{{ data.get('zipcode') }}"
           data-form-validation-required
           {% if requiredMessage is defined %}data-form-validation-required-message="{{ requiredMessage }}"{% endif %}
           required="required">
{% endblock %}

{% block component_address_form_additional_field1_input %}
    <input type="text"
           class="form-control {% if violationPath %} is-invalid{% endif %}"
           id="{{ idPrefix ~ prefix }}AdditionalField1"
           placeholder="{{ "address.additionalField1Placeholder"|trans|striptags }}{{ config('core.loginRegistration.additionalAddressField1Required') ? "general.required"|trans|sw_sanitize }}"
           name="{{ prefix }}[additionalAddressLine1]"
           value="{{ data.get('additionalAddressLine1') }}"
        {{ config('core.loginRegistration.additionalAddressField1Required') ? 'required="true"' }}>
{% endblock %}

{% block component_address_form_additional_field2_input %}
    <input type="text"
           class="form-control {% if violationPath %} is-invalid{% endif %}"
           id="{{ idPrefix ~ prefix }}AdditionalField2"
           placeholder="{{ "address.additionalField2Placeholder"|trans|striptags }}{{ config('core.loginRegistration.additionalAddressField2Required') ? "general.required"|trans|sw_sanitize }}"
           name="{{ prefix }}[additionalAddressLine2]"
           value="{{ data.get('additionalAddressLine2') }}"
        {{ config('core.loginRegistration.additionalAddressField2Required') ? 'required="true"' }}>
{% endblock %}

{% block component_address_form_street_input %}
    <input type="text"
           class="form-control{% if violationPath %} is-invalid{% endif %}"
           id="{{ idPrefix ~ prefix }}AddressStreet"
           placeholder="{{ "address.streetPlaceholder"|trans|striptags }}{{ "general.required"|trans|sw_sanitize }}"
           name="{{ prefix }}[street]"
           value="{{ data.get('street') }}"
           data-form-validation-required
           {% if requiredMessage is defined %}data-form-validation-required-message="{{ requiredMessage }}"{% endif %}
           required="required">
{% endblock %}

{% block component_address_form_address_fields %}
    <div class="{{ formRowClass }}">
        {% block component_address_form_street %}
            <div class="form-group col-lg-6">
                {% if formViolations.getViolations("/street") is not empty %}
                    {% set violationPath = "/street" %}
                {% elseif formViolations.getViolations("/#{prefix}/street") is not empty %}
                    {% set violationPath = "/#{prefix}/street" %}
                {% else %}
                    {% set requiredMessage = "error.VIOLATION::IS_BLANK_ERROR"|trans({ '%field%': "address.streetLabel"|trans|sw_sanitize }) %}
                {% endif %}

                {{ block('component_address_form_street_label') }}

                {{ block('component_address_form_street_input') }}

                {{ block('component_address_form_street_input_error') }}
            </div>
        {% endblock %}

        {% block component_address_form_zipcode_city %}
            {% set zipcodeField %}
                {% if formViolations.getViolations("/zipcode") is not empty %}
                    {% set violationPath = "/zipcode" %}
                {% elseif formViolations.getViolations("/#{prefix}/zipcode") is not empty %}
                    {% set violationPath = "/#{prefix}/zipcode" %}
                {% else %}
                    {% set requiredMessage = "error.VIOLATION::IS_BLANK_ERROR"|trans({ '%field%': "address.zipcodeLabel"|trans|sw_sanitize }) %}
                {% endif %}

                {{ block('component_address_form_zipcode_label') }}

                {{ block('component_address_form_zipcode_input') }}

                {{ block('component_address_form_zipcode_error') }}
            {% endset %}

            {% set cityField %}
                {% if formViolations.getViolations("/city") is not empty %}
                    {% set violationPath = "/city" %}
                {% elseif formViolations.getViolations("/#{prefix}/city") is not empty %}
                    {% set violationPath = "/#{prefix}/city" %}
                {% else %}
                    {% set requiredMessage = "error.VIOLATION::IS_BLANK_ERROR"|trans({ '%field%': "address.cityLabel"|trans|sw_sanitize }) %}
                    {% set violationPath = null %}
                {% endif %}

                {{ block('component_address_form_city_label') }}

                {{ block('component_address_form_city_input') }}

                {{ block('component_address_form_city_error') }}
            {% endset %}

            {% if config('core.address.showZipcodeInFrontOfCity') %}
                <div class="form-group col-4 col-lg-2">
                    {{ zipcodeField }}
                </div>

                <div class="form-group col-8 col-lg-4">
                    {{ cityField }}
                </div>
            {% else %}
                <div class="form-group col-8 col-lg-4">
                    {{ cityField }}
                </div>

                <div class="form-group col-4 col-lg-2">
                    {{ zipcodeField }}
                </div>
            {% endif %}
        {% endblock %}

        {{ block('component_address_form_additional_field1') }}

        {{ block('component_address_form_additional_field2') }}
    </div>

    <div class="{{ formRowClass }} country-and-state-form-elements" data-country-state-select="true">
        {% block component_address_form_country %}
            <div class="form-group col-lg-6">
                {% set initialCountryId = null %}

                {% if data.get('countryId') %}
                    {% set initialCountryId = data.get('countryId') %}
                {% elseif page.countries|length == 1 %}
                    {% set initialCountryId = (page.countries|first).id %}
                {% endif %}

                {% if formViolations.getViolations("/countryId") is not empty %}
                    {% set violationPath = "/countryId" %}
                {% elseif formViolations.getViolations("/#{prefix}/countryId") is not empty %}
                    {% set violationPath = "/#{prefix}/countryId" %}
                {% endif %}

                {{ block('component_address_form_country_label') }}

                {{ block('component_address_form_country_select') }}
            </div>

            <div class="form-group col-md-6 d-none">
                {% if formViolations.getViolations("/countryStateId") is not empty %}
                    {% set violationPath = "/countryStateId" %}
                {% elseif formViolations.getViolations("/#{prefix}/countryStateId") is not empty %}
                    {% set violationPath = "/#{prefix}/countryStateId" %}
                {% endif %}

                {{ block('component_address_form_country_state_label') }}

                {{ block('component_address_form_country_state_select') }}

                {{ block('component_address_form_country_error') }}
            </div>
        {% endblock %}
    </div>

    <div class="{{ formRowClass }}">
        {{ block('component_address_form_phone_number') }}
    </div>
{% endblock %}
