{# SwagEmporiumTheme Copyright (C) 2025 shopware AG #}

{% sw_extends '@Storefront/storefront/component/review/review.html.twig' %}

{% block utilities_offcanvas_close_icon %}{% endblock %}

{% block utilities_offcanvas_close_text %}
    {{ "detail.offcanvasCloseReviews"|trans|sw_sanitize }}
{% endblock %}

{% block component_review_list_container %}
    {% if productReviewCount > 0 %}
        <div class="product-detail-accordion" id="ratingsFilter">
            <button class="btn btn-light btn-buy" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRatingsFilter" aria-expanded="false">
                {{ "detail.reviewRatingsFilterLabel"|trans|sw_sanitize }}

                {% sw_icon 'arrow-head-down' %}
                {% sw_icon 'arrow-head-up' %}
            </button>

            <div class="collapse" id="collapseRatingsFilter">
                <div class="js-review-filter">
                    <form class="review-filter-form"
                          action="{{ path('frontend.product.reviews', { productId: product.id, parentId: product.parentId }) }}"
                          method="post"
                          data-form-ajax-submit="true"
                          data-form-ajax-submit-options='{{ formAjaxSubmitOptions|json_encode }}'>

                        {% if app.request.get('limit') %}
                            <input type="hidden" name="limit" value="{{ app.request.get('limit') }}">
                        {% endif %}

                        {% if app.request.get('language') %}
                            <input type="hidden" name="language" value="{{ app.request.get('language') }}">
                        {% endif %}

                        {% if app.request.get('sort') %}
                            <input type="hidden" name="sort" value="{{ app.request.get('sort') }}">
                        {% endif %}

                        {% for matrix in reviews.matrix.matrix %}
                            {% block clone_component_review_filter_box %}
                                <div class="product-detail-review-filter">
                                    <div class="product-detail-review-quality">{{ "detail.review#{matrix.points}PointRatingText"|trans|sw_sanitize }}</div>
                                    <div class="product-detail-review-counter">{{ matrix.count }} {{ "detail.reviewLabel"|trans|sw_sanitize }}</div>

                                    {% block clone_component_review_filter_progressbar %}
                                        <div class="product-detail-review-progressbar-col">
                                            <div class="progress product-detail-review-progressbar-container">
                                                <div class="progress-bar product-detail-review-progressbar-bar"
                                                     role="progressbar"
                                                     style="width: {{ matrix.percent }}%;"
                                                     aria-valuenow="{{ matrix.percent }}"
                                                     aria-valuemin="0"
                                                     aria-valuemax="100"></div>
                                            </div>
                                        </div>
                                    {% endblock %}

                                    {% block clone_component_review_filter_share %}
                                        <div class="product-detail-review-share">
                                            <p><small>{{ matrix.percent|round }}%</small></p>
                                        </div>
                                    {% endblock %}

                                    {% block component_review_filter_checkbox_input %}
                                        <input type="checkbox"
                                               class="form-check-input"
                                               id="reviewRating{{ matrix.points }}"
                                               name="points[]"
                                            {% if app.request.get('points') %}
                                                {% for points in app.request.get('points') %}
                                                    {% if points == matrix.points %}
                                                        checked="checked"
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                               value="{{ matrix.points }}"
                                            {% if matrix.count < 1 %}disabled{% endif %}>
                                    {% endblock %}

                                    {% block component_review_filter_checkbox_label %}
                                        <label class="form-check-label text-nowrap"
                                               for="reviewRating{{ matrix.points }}">
                                        </label>
                                    {% endblock %}
                                </div>
                            {% endblock %}
                        {% endfor %}
                    </form>
                </div>
            </div>
        </div>
    {% endif %}

    {% if productReviewCount <= 0 %}
        {% block component_review_list_empty %}
            {% sw_include '@Storefront/storefront/utilities/alert.html.twig' with {
                type: "info",
                content: "detail.reviewListEmpty"|trans|sw_sanitize
            } %}
        {% endblock %}
    {% endif %}

    {{ block('component_review_list') }}
{% endblock %}

{% block component_review_list_action_language %}
    <div class="col col-lg-4 product-detail-review-language">
        {% if foreignReviewsCount > 0 %}
            <form class="product-detail-review-language-form"
                  action="{{ path('frontend.product.reviews', { productId: product.id, parentId: product.parentId }) }}"
                  method="post"
                  data-form-ajax-submit="true"
                  data-form-ajax-submit-options='{{ formAjaxSubmitOptions|json_encode }}'>

                {% if app.request.get('limit') %}
                    <input type="hidden" name="limit" value="{{ app.request.get('limit') }}">
                {% endif %}

                {% if app.request.get('sort') %}
                    <input type="hidden" name="sort" value="{{ app.request.get('sort') }}">
                {% endif %}

                <div class="form-check form-switch">
                    {# TODO NEXT-16994 - set checked and disabled state #}
                    <input type="checkbox"
                           class="form-check-input"
                           id="showForeignReviews"
                           value="filter-language"
                           name="language"
                           {% if app.request.get('language') %}checked="checked"{% endif %}>
                    <label class="form-check-label form-label"
                           for="showForeignReviews">
                        <small>{{ "detail.reviewLanguageFilterLabel"|trans|sw_sanitize }}</small>
                    </label>
                </div>
            </form>
        {% endif %}
    </div>
{% endblock %}
